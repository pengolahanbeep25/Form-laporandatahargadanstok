<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Form Analisis Usaha Tani</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(135deg, #b6e7c9, #88d498);
    margin: 0;
    padding: 0;
  }
  .container {
    max-width: 850px;
    margin: 40px auto;
    background: #ffffff;
    border-radius: 10px;
    padding: 25px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
    color: #146c43;
  }
  .step {
    display: none;
  }
  .step.active {
    display: block;
  }
  .button-group {
    margin-top: 20px;
    text-align: right;
  }
  .button-group button {
    padding: 10px 20px;
    margin-left: 5px;
    font-size: 15px;
    background: #198754;
    border: none;
    color: white;
    border-radius: 5px;
    cursor: pointer;
  }
  .button-group button:hover {
    background: #157347;
  }
  .progressbar {
    counter-reset: step;
    display: flex;
    margin-bottom: 30px;
    flex-wrap: wrap;
  }
  .progressbar li {
    list-style-type: none;
    width: 20%;
    position: relative;
    text-align: center;
    font-weight: 600;
    color: #6c757d;
  }
  .progressbar li:before {
    content: counter(step);
    counter-increment: step;
    width: 28px;
    height: 28px;
    line-height: 28px;
    border: 2px solid #6c757d;
    display: block;
    text-align: center;
    margin: 0 auto 8px auto;
    border-radius: 50%;
    background-color: white;
  }
  .progressbar li:after {
    content: '';
    position: absolute;
    width: 100%;
    height: 2px;
    background-color: #6c757d;
    top: 14px;
    left: -50%;
    z-index: -1;
  }
  .progressbar li:first-child:after {
    content: none;
  }
  .progressbar li.active {
    color: #198754;
  }
  .progressbar li.active:before {
    border-color: #198754;
  }
  .progressbar li.active + li:after {
    background-color: #198754;
  }
  label {
    display: block;
    margin-top: 10px;
    font-weight: 500;
    color: #333;
  }
  input[type=text], input[type=tel], input[type=number], select {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
  }
  input.auto {
    background-color: #f2f2f2;
  }
  @media (max-width: 600px) {
    .container {
      padding: 15px;
    }
    .button-group button {
      width: 48%;
      margin: 3px 1%;
    }
  }
</style>
</head>
<body>
<div class="container">
  <h1>Form Analisis Usaha Tani</h1>
  <ul class="progressbar">
    <li class="active">Data Dasar</li>
    <li>Produksi</li>
    <li>Biaya Tetap</li>
    <li>Biaya Variabel</li>
    <li>Ringkasan</li>
  </ul>

  <form id="mainForm">

    <!-- STEP 1: DATA DASAR -->
    <div class="step active" id="step1">
      <h2>DATA DASAR</h2>
      <label>Nama PIC *</label>
      <input type="text" id="nama_pic" required>
      <label>No. HP PIC *</label>
      <input type="tel" id="hp_pic" placeholder="08XXXXXXXXXX" required>
      <label>Jenis Kelompok *</label>
      <select id="jenis_kelompok" required>
        <option value="">Pilih</option>
        <option value="Poktan">Poktan</option>
        <option value="Gapoktan">Gapoktan</option>
        <option value="KWT">KWT</option>
      </select>
      <label>Nama Kelompok *</label>
      <input type="text" id="nama_kelompok" required>
      <label>Provinsi *</label>
      <select id="provinsi" required>
        <option value="Riau" selected>Riau</option>
      </select>
      <label>Kota/Kabupaten *</label>
      <select id="kabupaten" required>
        <option value="Tembilahan" selected>Tembilahan</option>
      </select>
      <label>Kecamatan *</label>
      <select id="kecamatan" required onchange="populateDesa()"></select>
      <label>Desa/Kelurahan *</label>
      <select id="desa_kelurahan" required></select>
      <label>Alamat *</label>
      <input type="text" id="alamat" required>
      <label>Jenis Lahan *</label>
      <select id="jenis_lahan" required>
        <option value="">Pilih</option>
        <option value="Sawah">Sawah</option>
        <option value="Tadah Hujan">Tadah Hujan</option>
        <option value="Lahan Kering">Lahan Kering</option>
      </select>
      <label>Luas Lahan (Ha)</label>
      <input type="number" step="0.01" id="luas_lahan">
      <label>Varietas *</label>
      <input type="text" id="varietas" required>
      <label>Periode Tanam *</label>
      <input type="text" id="periode_tanam" required>
      <label>Umur Panen (Hari)</label>
      <input type="number" id="umur_panen">
      <div class="button-group">
        <button type="button" onclick="nextStep()">Lanjut</button>
      </div>
    </div>

    <!-- STEP 2: PRODUKSI -->
    <div class="step" id="step2">
      <h2>Produksi</h2>
      <label>Produksi (Volume) (Kg)</label>
      <input type="number" id="produksi_volume" oninput="hitungProduksi()">
      <label>Produksi (Harga) (Rp)</label>
      <input type="number" id="produksi_harga" oninput="hitungProduksi()">
      <label>Produksi (Total) (Rp)</label>
      <input type="number" id="produksi_total" class="auto" readonly>
      <div class="button-group">
        <button type="button" onclick="prevStep()">Kembali</button>
        <button type="button" onclick="nextStep()">Lanjut</button>
      </div>
    </div>
    <!-- STEP 3: BIAYA TETAP -->
    <div class="step" id="step3">
      <h2>Biaya Tetap</h2>
      <h3>a) Sewa Lahan</h3>
      <label>Volume (Ha/MT)</label>
      <input type="number" id="sewa_volume" oninput="hitungSewa()">
      <label>Harga (Rp)</label>
      <input type="number" id="sewa_harga" oninput="hitungSewa()">
      <label>Total (Rp)</label>
      <input type="number" id="sewa_total" class="auto" readonly>

      <h3>b) Penyusutan Alsintan</h3>
      <label>Traktor (Rp)</label>
      <input type="number" id="traktor" oninput="hitungPenyusutan()">
      <label>Combine Harvester (Rp)</label>
      <input type="number" id="combine" oninput="hitungPenyusutan()">
      <label>Power Thresher (Rp)</label>
      <input type="number" id="thresher" oninput="hitungPenyusutan()">
      <label>Pompa Air (Rp)</label>
      <input type="number" id="pompa" oninput="hitungPenyusutan()">
      <label>Cangkul/Sabit (Rp)</label>
      <input type="number" id="alat_tangan" oninput="hitungPenyusutan()">
      <label>Total Penyusutan (Rp)</label>
      <input type="number" id="penyusutan_total" class="auto" readonly>

      <div class="button-group">
        <button type="button" onclick="prevStep()">Kembali</button>
        <button type="button" onclick="nextStep()">Lanjut</button>
      </div>
    </div>

    <!-- STEP 4: BIAYA VARIABEL -->
    <div class="step" id="step4">
      <h2>Biaya Variabel</h2>

      <h3>a) Benih</h3>
      <label>Volume</label>
      <input type="number" id="benih_vol" oninput="hitungBenih()">
      <label>Harga (Rp)</label>
      <input type="number" id="benih_harga" oninput="hitungBenih()">
      <label>Total (Rp)</label>
      <input type="number" id="benih_total" class="auto" readonly>

      <h3>b) Pupuk</h3>
      <label>Pupuk Urea (Rp)</label>
      <input type="number" id="urea" oninput="hitungPupuk()">
      <label>Pupuk NPK (Rp)</label>
      <input type="number" id="npk" oninput="hitungPupuk()">
      <label>Pupuk Organik (Rp)</label>
      <input type="number" id="organik" oninput="hitungPupuk()">
      <label>Total Pupuk (Rp)</label>
      <input type="number" id="pupuk_total" class="auto" readonly>

      <h3>c) Pestisida</h3>
      <label>Herbisida (Rp)</label>
      <input type="number" id="herbisida" oninput="hitungPestisida()">
      <label>Insektisida (Rp)</label>
      <input type="number" id="insektisida" oninput="hitungPestisida()">
      <label>Fungisida (Rp)</label>
      <input type="number" id="fungisida" oninput="hitungPestisida()">
      <label>Total Pestisida (Rp)</label>
      <input type="number" id="pestisida_total" class="auto" readonly>

      <h3>d) Tenaga Kerja</h3>
      <label>Upah Pengolahan (Rp)</label>
      <input type="number" id="upah_pengolahan" oninput="hitungUpah()">
      <label>Upah Penanaman (Rp)</label>
      <input type="number" id="upah_tanam" oninput="hitungUpah()">
      <label>Upah Panen (Rp)</label>
      <input type="number" id="upah_panen" oninput="hitungUpah()">
      <label>Total Tenaga Kerja (Rp)</label>
      <input type="number" id="upah_total" class="auto" readonly>

      <h3>e) Sewa Alat/Sarana</h3>
      <label>Traktor (Rp)</label>
      <input type="number" id="sewa_traktor" oninput="hitungSewaAlat()">
      <label>Pompa Air (Rp)</label>
      <input type="number" id="sewa_pompa" oninput="hitungSewaAlat()">
      <label>Total Sewa Alat (Rp)</label>
      <input type="number" id="sewaalat_total" class="auto" readonly>

      <h3>f) Bahan Bakar</h3>
      <label>Solar/Bensin (Rp)</label>
      <input type="number" id="bahanbakar" oninput="hitungBahanBakar()">
      <label>Total Bahan Bakar (Rp)</label>
      <input type="number" id="bahanbakar_total" class="auto" readonly>

      <div class="button-group">
        <button type="button" onclick="prevStep()">Kembali</button>
        <button type="button" onclick="nextStep()">Lanjut</button>
      </div>
    </div>

    <!-- STEP 5: RINGKASAN -->
    <div class="step" id="step5">
      <h2>Ringkasan Usaha Tani</h2>
      <label>Total Biaya Tetap (Rp)</label>
      <input type="number" id="biaya_tetap_total" class="auto" readonly>
      <label>Total Biaya Variabel (Rp)</label>
      <input type="number" id="biaya_variabel_total" class="auto" readonly>
      <label>Total Biaya Produksi (Rp)</label>
      <input type="number" id="biaya_produksi_total" class="auto" readonly>
      <label>Keuntungan (Rp)</label>
      <input type="number" id="keuntungan_usaha" class="auto" readonly>
      <label>R/C Ratio</label>
      <input type="number" id="rc_ratio" class="auto" readonly>
      <label>HPP (Rp)</label>
      <input type="number" id="hpp" class="auto" readonly>
      <div class="button-group">
        <button type="button" onclick="prevStep()">Kembali</button>
        <button type="submit">Kirim</button>
      </div>
    </div>

  </form>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyo4vX_a18Q97l1mX2ZhiNkyUegy_eLZIZFvP5goXw-Z_dMhArmb04CXqa1tvOywEPH/exec";

// navigasi step
let currentStep = 1;
function showStep(n){
  document.querySelectorAll(".step").forEach((s,i)=>{
    s.classList.toggle("active",i===n-1);
  });
  document.querySelectorAll(".progressbar li").forEach((el,idx)=>{
    el.classList.toggle("active",idx<n);
  });
}
function nextStep(){if(currentStep<5){currentStep++;showStep(currentStep);}}
function prevStep(){if(currentStep>1){currentStep--;showStep(currentStep);}}

// populasi kecamatan & desa
const dataKec = {
  "Batang Tuaka":["Sungai Piring","Gemilang Jaya","Kuala Sebatu","Pasir Emas","Sialang Jaya","Simpang Jaya","Sungai Dusun","Sungai Junjangan","Sungai Luar","Sungai Rawa","Sungai Raya","Tanjung Siantar","Tasik Raya"],
  "Concong":["Concong Dalam","Concong Luar","Concong Tengah","Kampung Baru","Panglima Raja","Sungai Berapit"],
  "Enok":["Bagan Jaya","Enok","Jaya Bhakti","Pengalihan","Pusaran","Rantau Panjang","Simpang Tiga","Suhada","Sungai Ambat","Sungai Lokan","Sungai Rukam","Teluk Medan"],
  "Gaung":["Belantaraya","Gembira","Jerambang","Kuala Lahang","Lahang Baru","Lahang Hulu","Lahang Tengah","Pungkat","Simpang Gaung","Sungai Baru","Teluk Kabung","Terusan Kempas"],
  "Gaung Anak Serka":["Bandar Sri Gemilang","Batu Ampar","Bayas Jaya","Kuala Lahang","Teluk Sungka","Teluk Jira"],
  "Kateman":["Air Tawar","Bagan Melibur","Kuala Selat","Kuala Selat Selatan","Tagaraja","Sungai Teritip"],
  "Kempas":["Kempas Jaya","Rumbai Jaya","Seberang Kempas","Pauh","Pelanduk","Pangkalan Jambu"],
  "Kemuning":["Kemuning Muda","Sekara","Talang Jangkang","Beringin Jaya"],
  "Keritang":["Batang Tumu","Pengalihan","Kuala Keritang","Pasar Kembang","Sungai Buluh"],
  "Kuala Indragiri":["Kuala Lahang","Rambaian","Sungai Intan","Pasir Putih"],
  "Mandah":["Batang Tumu","Pelangiran","Suak Madura","Bekawan","Bente"],
  "Pelangiran":["Sungai Beringin","Tagagiri Tama Jaya","Pelangiran","Sungai Simbar","Lahang"],
  "Pulau Burung":["Pulau Burung","Sumber Jaya","Simpang Kiri","Pusaran"],
  "Reteh":["Sungai Undan","Pulau Kijang","Sungai Ara","Teluk Kiambang"],
  "Sungai Batang":["Sungai Batang","Sungai Junjangan","Sungai Dusun","Teluk Medan"],
  "Tanah Merah":["Tanah Merah","Tanjung Baru","Tanjung Pasir","Tanah Merah Hulu"],
  "Teluk Belengkong":["Teluk Belengkong","Teluk Kiambang","Teluk Medan"],
  "Tembilahan":["Pekan Arba","Seberang Tembilahan","Seberang Tembilahan Barat","Seberang Tembilahan Selatan","Sungai Beringin","Sungai Perak","Tembilahan Hilir","Tembilahan Kota"],
  "Tembilahan Hulu":["Tembilahan Hulu","Sungai Intan","Pekan Kamis","Pekan Arba"],
  "Tempuling":["Tempuling","Mumpa","Teluk Jira","Pelanduk","Pangkalan Jambu"]
};
const kecSelect=document.getElementById("kecamatan");
for(const k in dataKec){
  const opt=document.createElement("option");
  opt.value=k;opt.text=k;kecSelect.appendChild(opt);
}
function populateDesa(){
  const desaSelect=document.getElementById("desa_kelurahan");
  desaSelect.innerHTML="";
  const kec=kecSelect.value;
  if(dataKec[kec]){
    dataKec[kec].forEach(d=>{
      const opt=document.createElement("option");
      opt.value=d;opt.text=d;desaSelect.appendChild(opt);
    });
  }
}

// fungsi hitung sederhana
function hitungProduksi(){
  const v=+document.getElementById("produksi_volume").value||0;
  const h=+document.getElementById("produksi_harga").value||0;
  document.getElementById("produksi_total").value=v*h;
  updateRingkasan();
}
function hitungSewa(){
  const v=+sewa_volume.value||0, h=+sewa_harga.value||0;
  sewa_total.value=v*h; updateRingkasan();
}
function hitungPenyusutan(){
  const total=(+traktor.value||0)+(+combine.value||0)+(+thresher.value||0)+(+pompa.value||0)+(+alat_tangan.value||0);
  penyusutan_total.value=total; updateRingkasan();
}
function hitungBenih(){benih_total.value=(+benih_vol.value||0)*(+benih_harga.value||0);updateRingkasan();}
function hitungPupuk(){
  pupuk_total.value=(+urea.value||0)+(+npk.value||0)+(+organik.value||0);
  updateRingkasan();
}
function hitungPestisida(){
  pestisida_total.value=(+herbisida.value||0)+(+insektisida.value||0)+(+fungisida.value||0);
  updateRingkasan();
}
function hitungUpah(){
  upah_total.value=(+upah_pengolahan.value||0)+(+upah_tanam.value||0)+(+upah_panen.value||0);
  updateRingkasan();
}
function hitungSewaAlat(){
  sewaalat_total.value=(+sewa_traktor.value||0)+(+sewa_pompa.value||0);
  updateRingkasan();
}
function hitungBahanBakar(){
  bahanbakar_total.value=(+bahanbakar.value||0);
  updateRingkasan();
}

function updateRingkasan(){
  const produksi=+produksi_total.value||0;
  const biaya_tetap=(+sewa_total.value||0)+(+penyusutan_total.value||0);
  const biaya_variabel=(+benih_total.value||0)+(+pupuk_total.value||0)+(+pestisida_total.value||0)+(+upah_total.value||0)+(+sewaalat_total.value||0)+(+bahanbakar_total.value||0);
  const total=biaya_tetap+biaya_variabel;
  biaya_tetap_total.value=biaya_tetap;
  biaya_variabel_total.value=biaya_variabel;
  biaya_produksi_total.value=total;
  keuntungan_usaha.value=produksi-total;
  rc_ratio.value=total>0?(produksi/total).toFixed(2):"";
  hpp.value=produksi>0?(total/produksi).toFixed(2):"";
}

// kirim data ke spreadsheet
document.getElementById("mainForm").addEventListener("submit", e=>{
  e.preventDefault();
  const data={};
  document.querySelectorAll("input,select").forEach(el=>data[el.id]=el.value);
  fetch(scriptURL,{
    method:"POST",
    body:JSON.stringify(data),
    headers:{"Content-Type":"application/json"}
  }).then(r=>r.text()).then(()=>{
    alert("✅ Data berhasil dikirim!");
    document.getElementById("mainForm").reset();
    currentStep=1;showStep(currentStep);
  }).catch(err=>{
    alert("❌ Gagal kirim data: "+err);
  });
});
</script>
</body>
</html>


