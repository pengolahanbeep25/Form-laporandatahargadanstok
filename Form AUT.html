<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>Form Analisis Usaha Tani - Dinas PTPHP Inhil</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: url('https://assets.promediateknologi.id/crop/0x0:0x0/0x0/webp/photo/p3/155/2025/04/10/Screen-Shot-2025-04-10-at-224530-3222523999.png') no-repeat center center fixed;
      background-size: cover;
      color: #333;
    }
    .overlay {
      background: rgba(255,255,255,0.94);
      min-height: 100vh;
      padding: 20px;
    }
    .kop {
      display: flex;
      align-items: center;
      border-bottom: 3px solid #2d6a4f;
      padding-bottom: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .kop img {height: 80px; margin-right: 15px;}
    .kop-text {flex: 1; text-align: center;}
    .kop-text h2, .kop-text h3, .kop-text p {margin: 2px 0;}
    .kop-text h2 {font-size: 18px; font-weight: bold; color: #1b4332;}
    .kop-text h3 {font-size: 16px; color: #2d6a4f; font-weight: bold;}
    .judul-form {text-align: center; margin-bottom: 25px;}
    .judul-form h3 {
      display: inline-block;
      font-size: 20px;
      color: #1b4332;
      border-bottom: 3px solid #2d6a4f;
      padding-bottom: 5px;
    }
    .form-step {
      display: none;
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .form-step.active {display: block; animation: fadeIn 0.5s ease-in-out;}
    @keyframes fadeIn {from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);}}
    h4 {color: #1b4332; border-left: 5px solid #2d6a4f; padding-left: 10px;}
    label {display: block; margin-top: 10px; font-weight: 600;}
    input, select, textarea {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-top: 5px; box-sizing: border-box;
    }
    textarea {resize: vertical;}
    button {
      background: #2d6a4f; color: #fff; border: none; padding: 12px 20px; border-radius: 8px;
      cursor: pointer; transition: 0.3s; width: 100%;
    }
    button:hover {background: #1b4332;}
    .btn-group {display: flex; justify-content: space-between; gap: 10px; margin-top: 20px;}
    .progress {display: flex; justify-content: space-between; margin-bottom: 20px;}
    .progress div {
      flex: 1; height: 8px; margin: 0 4px; border-radius: 5px; background-color: #ccc;
    }
    .progress div.active {background-color: #2d6a4f;}
    @media(max-width:768px){input,select,button{font-size:15px;}}
  </style>
</head>
<body>
  <div class="overlay">
    <div class="kop">
      <img src="https://www.inhilkab.go.id/assets/portal/img/logos/logo-inhil-small.png" alt="Logo Inhil" />
      <div class="kop-text">
        <h2>PEMERINTAH KABUPATEN INDRAGIRI HILIR</h2>
        <h3>DINAS PANGAN, TANAMAN PANGAN, HORTIKULTURA DAN PETERNAKAN</h3>
        <p>Jl. Pangeran Diponegoro No.50, Tembilahan - Kode Pos 29212</p>
      </div>
    </div>

    <div class="judul-form"><h3>FORM ANALISIS USAHA TANI</h3></div>

    <div class="progress" id="progress-bar">
      <div class="active"></div><div></div><div></div><div></div><div></div>
    </div>

    <form id="dataForm">
      <!-- STEP 1 -->
      <div class="form-step active">
        <h4>STEP 1 - DATA DASAR</h4>
        <label>Nama PIC</label><input name="Nama PIC" required>
        <label>No. HP PIC</label><input name="No HP PIC" required placeholder="08XXXXXXXXXX">
        <label>Jenis Kelompok</label>
        <select name="Jenis Kelompok" required><option>Poktan</option><option>Gapoktan</option><option>KWT</option></select>
        <label>Nama Kelompok</label><input name="Nama Kelompok" required>
        <label>Provinsi</label><input name="Provinsi" value="Riau" readonly>
        <label>Kabupaten/Kota</label><input name="Kabupaten/Kota" value="Tembilahan" readonly>
        <label>Kecamatan</label><select id="kecamatan" name="Kecamatan" required></select>
        <label>Desa/Kelurahan</label><select id="desa" name="Desa/Kelurahan" required></select>
        <label>Alamat</label><textarea name="Alamat"></textarea>
        <div class="btn-group"><button type="button" class="btn-next">Lanjut</button></div>
      </div>

      <!-- STEP 2 -->
      <div class="form-step">
        <h4>STEP 2 - PRODUKSI</h4>
        <label>Jenis Lahan</label><input name="Jenis Lahan" required>
        <label>Luas Lahan (Ha)</label><input type="number" step="0.01" name="Luas Lahan" required>
        <label>Varietas</label><input name="Varietas">
        <label>Periode Tanam</label><input name="Periode Tanam">
        <label>Umur Panen (Hari)</label><input type="number" name="Umur Panen (Hari)">
        <label>Produksi (Volume) (Kg)</label><input type="number" id="prod_kg" name="Produksi (Volume) (Kg)">
        <label>Produksi (Harga) (Rp)</label><input type="number" id="prod_harga" name="Produksi (Harga) (Rp)">
        <label>Produksi (Total) (Rp)</label><input type="text" id="prod_total" readonly>
        <div class="btn-group"><button type="button" class="btn-prev">Kembali</button><button type="button" class="btn-next">Lanjut</button></div>
      </div>

      <!-- STEP 3 -->
      <div class="form-step">
        <h4>STEP 3 - BIAYA PRODUKSI</h4>
        <label>Sewa Lahan (Rp)</label><input type="number" name="Sewa Lahan (Rp)">
        <label>Upah Tenaga Kerja (Rp)</label><input type="number" name="Upah Tenaga Kerja (Rp)">
        <label>Biaya Pupuk (Rp)</label><input type="number" name="Biaya Pupuk (Rp)">
        <label>Biaya Pestisida (Rp)</label><input type="number" name="Biaya Pestisida (Rp)">
        <label>Biaya Lainnya (Rp)</label><input type="number" name="Biaya Lainnya (Rp)">
        <div class="btn-group"><button type="button" class="btn-prev">Kembali</button><button type="button" class="btn-next">Lanjut</button></div>
      </div>

      <!-- STEP 4 -->
      <div class="form-step">
        <h4>STEP 4 - ANALISIS KEUNTUNGAN</h4>
        <label>Biaya Produksi Total (Rp)</label><input type="number" name="Biaya Produksi (Total) (Rp)">
        <label>Keuntungan Usaha Tani (Rp)</label><input type="number" name="Keuntungan Usaha Tani (Rp)">
        <label>R/C</label><input type="text" name="R/C">
        <label>BEP (Rp/Kg)</label><input type="text" name="BEP (Rp/Kg)">
        <label>HPP (Rp)</label><input type="text" name="HPP (Rp)">
        <div class="btn-group"><button type="button" class="btn-prev">Kembali</button><button type="button" class="btn-next">Lanjut</button></div>
      </div>

      <!-- STEP 5 -->
      <div class="form-step">
        <h4>STEP 5 - RINGKASAN</h4>
        <label>Kesimpulan</label>
        <select name="Kesimpulan"><option>Produksi Meningkat</option><option>Produksi Stabil</option><option>Produksi Menurun</option></select>
        <label>Tanggal Input</label><input type="date" name="Tanggal Input" id="tanggal_input">
        <div class="btn-group"><button type="button" class="btn-prev">Kembali</button><button type="submit">Kirim Data</button></div>
      </div>
    </form>
  </div>

<script>
  // === Multi Step Logic ===
  const steps = document.querySelectorAll(".form-step");
  const nextBtns = document.querySelectorAll(".btn-next");
  const prevBtns = document.querySelectorAll(".btn-prev");
  const bars = document.querySelectorAll("#progress-bar div");
  let current = 0;
  nextBtns.forEach(btn => btn.onclick = () => {if(current < steps.length-1){steps[current].classList.remove("active");bars[current].classList.remove("active");current++;steps[current].classList.add("active");bars[current].classList.add("active");}});
  prevBtns.forEach(btn => btn.onclick = () => {if(current > 0){steps[current].classList.remove("active");bars[current].classList.remove("active");current--;steps[current].classList.add("active");bars[current].classList.add("active");}});

  // === Auto Hitung Produksi Total ===
  const vol = document.getElementById("prod_kg");
  const harga = document.getElementById("prod_harga");
  const total = document.getElementById("prod_total");
  function hitung() {
    const v = parseFloat(vol.value)||0;
    const h = parseFloat(harga.value)||0;
    total.value = (v*h).toLocaleString("id-ID");
  }
  vol.oninput = hitung; harga.oninput = hitung;

  // === Isi Otomatis Tanggal ===
  document.getElementById("tanggal_input").valueAsDate = new Date();

  // === Kecamatan & Desa Data (pendek disingkat biar ringan) ===
  const kec = {"Tembilahan":["Tembilahan Kota","Pekan Arba","Sungai Beringin"],"Tembilahan Hulu":["Pulau Palas","Sialang Panjang","Sungai Intan"],"Batang Tuaka":["Gemilang Jaya","Tasik Raya","Sungai Junjangan"],"Concong":["Concong Dalam","Concong Luar","Kampung Baru"],"Enok":["Enok","Simpang Tiga","Pantai Seberang Makmur"],"Gaung":["Kuala Lahang","Belantaraya","Soren"],"Gaung Anak Serka":["Teluk Pinang","Kuala Gaung","Rambaian"],"Kateman":["Tagaraja","Sungai Simbar","Penjuru"],"Kempas":["Kempas Jaya","Harapan Tani","Pekan Tua"],"Kemuning":["Selensen","Lubuk Besar","Sekara"],"Keritang":["Kota Baru Reteh","Kayu Raja","Seberang Pebenaan"],"Kuala Indragiri":["Sapat","Perigi Raja","Sungai Buluh"],"Mandah":["Khairiah Mandah","Pulau Cawan","Igal"],"Pelangiran":["Pelangiran","Bagan Jaya","Rotan Semelur"],"Pulau Burung":["Pulau Burung","Suka Jaya","Sapta Jaya"],"Reteh":["Pulau Kijang","Metro","Seberang Sanglar"],"Sungai Batang":["Benteng","Kuala Sungai Batang"],"Tanah Merah":["Kuala Enok","Tekulai Bugis","Sungai Laut"],"Teluk Belengkong":["Gembaran","Hibrida Jaya"],"Tempuling":["Mumpa","Teluk Jira","Sungai Salak"]};
  const kecSelect=document.getElementById("kecamatan"),desaSelect=document.getElementById("desa");
  for(let k in kec){let opt=document.createElement("option");opt.value=k;opt.text=k;kecSelect.append(opt);}
  kecSelect.onchange=()=>{desaSelect.innerHTML="";kec[kecSelect.value].forEach(d=>{let o=document.createElement("option");o.text=d;desaSelect.append(o);});};

  // === Kirim ke Google Spreadsheet ===
  const form=document.getElementById("dataForm");
  form.addEventListener("submit",async e=>{
    e.preventDefault();
    const fd=new FormData(form);
    fd.append("Timestamp",new Date().toLocaleString("id-ID"));
    try{
      await fetch("https://script.google.com/macros/s/AKfycbxq7GyZtY0S8dc6lWZlAXp86OZUpqXvJDVNux3vpkD6WNE0AyI3G5XeAhXHb5kOPm6z/exec",{method:"POST",body:fd});
      alert("✅ Data berhasil dikirim ke Spreadsheet!");
      form.reset();steps.forEach(s=>s.classList.remove("active"));steps[0].classList.add("active");bars.forEach((b,i)=>b.classList.toggle("active",i===0));
    }catch(err){alert("❌ Gagal mengirim: "+err);}
  });
</script>
</body>
</html>
