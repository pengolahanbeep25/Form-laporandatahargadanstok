<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>Form Input Data Gabah & Beras</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #333;
    }
    .overlay {
      background: rgba(255,255,255,0.95);
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box;
    }
    .kop {
      display: flex;
      align-items: center;
      border-bottom: 3px solid #2d6a4f;
      padding-bottom: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .kop img {
      height: 80px;
      margin-right: 15px;
    }
    .kop-text {
      flex: 1;
      text-align: center;
    }
    .kop-text h2, .kop-text h3, .kop-text p {
      margin: 2px 0;
      line-height: 1.4;
    }
    .kop-text h2 {
      font-size: 18px;
      font-weight: bold;
      color: #1b4332;
    }
    .kop-text h3 {
      font-size: 16px;
      font-weight: bold;
      color: #2d6a4f;
    }
    .judul-form {
      text-align: center;
      margin-bottom: 25px;
    }
    .judul-form h3 {
      font-size: 20px;
      color: #1b4332;
      border-bottom: 3px solid #2d6a4f;
      display: inline-block;
      padding-bottom: 5px;
    }
    .form-section {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .form-section h4 {
      margin-top: 0;
      color: #1b4332;
      border-left: 5px solid #2d6a4f;
      padding-left: 10px;
      font-size: 16px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: 600;
      font-size: 14px;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 5px;
      font-size: 14px;
      box-sizing: border-box;
    }
    input[readonly] {
      background: #f1f1f1;
    }
    small {
      font-size: 12px;
      color: #555;
    }
    button {
      display: block;
      width: 100%;
      padding: 14px;
      font-size: 16px;
      background: #2d6a4f;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #1b4332;
    }

    /* Tambahan mobile friendly */
    @media (max-width: 768px) {
      .overlay {
        padding: 15px;
      }
      .kop {
        flex-direction: column;
        text-align: center;
      }
      .kop img {
        margin: 0 0 10px 0;
        height: 70px;
      }
      .kop-text h2 {
        font-size: 16px;
      }
      .kop-text h3 {
        font-size: 14px;
      }
      .form-section {
        padding: 15px;
      }
      input, select, button {
        font-size: 15px;
      }
    }

    /* Optimasi di layar sangat kecil (HP lama) */
    @media (max-width: 480px) {
      body {
        font-size: 14px;
      }
      .kop-text h2, .kop-text h3 {
        font-size: 13px;
      }
      button {
        padding: 12px;
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="overlay">
    <!-- KOP DINAS -->
    <div class="kop">
      <img src="https://www.inhilkab.go.id/assets/portal/img/logos/logo-inhil-big.png" alt="Logo" />
      <div class="kop-text">
        <h2>PEMERINTAH KABUPATEN INDRAGIRI HILIR</h2>
        <h3>DINAS PANGAN, TANAMAN PANGAN, HORTIKULTURA DAN PETERNAKAN</h3>
        <p>Jalan Pangeran Diponegoro No.50 Tembilahan Kode Pos 29212</p>
        <p>Telepon (0768) 21094, Fax (0768) 325516</p>
      </div>
    </div>

    <!-- JUDUL FORM -->
    <div class="judul-form">
      <h3>FORM LAPORAN DATA STOK DAN HARGA DI PETANI/PENGGILINGAN</h3>
    </div>

    <!-- FORM -->
    <form id="dataForm">
        <!-- Identitas -->
      <div class="form-section">
        <h4>Identitas Pelapor</h4>
        <label>Nama Petani/Pelapor:</label>
        <input type="text" name="nama" required />

        <label>Kecamatan:</label>
        <select name="kecamatan" id="kecamatan" required>
          <option value="">-- Pilih Kecamatan --</option>
          <option>Batang Tuaka</option>
          <option>Concong</option>
          <option>Enok</option>
          <option>Gaung</option>
          <option>Gaung Anak Serka</option>
          <option>Kateman</option>
          <option>Kempas</option>
          <option>Kemuning</option>
          <option>Keritang</option>
          <option>Kuala Indragiri</option>
          <option>Mandah</option>
          <option>Pelangiran</option>
          <option>Pulau Burung</option>
          <option>Reteh</option>
          <option>Sungai Batang</option>
          <option>Tanah Merah</option>
          <option>Teluk Belengkong</option>
          <option>Tembilahan</option>
          <option>Tembilahan Hulu</option>
          <option>Tempuling</option>
        </select>

        <label>Desa/Kelurahan:</label>
        <select name="desa" id="desa" required>
          <option value="">-- Pilih Desa/Kelurahan --</option>
        </select>
      </div>

      <!-- Gabah Kering Panen -->
      <div class="form-section">
        <h4>Gabah Kering Panen (GKP)</h4>
        <label>Stok Hari ini:</label>
        <input type="number" name="stok_gkp" />
        <small>(stok dalam satuan Kilogram)</small>

        <label>Kadar Air (%):</label>
        <input type="number" name="kadarair_gkp" />

        <label>Harga Petani (Rp):</label>
        <input type="number" name="harga_petani_gkp" />
        <small>(harga petani ini harga jual petani ke luar)</small>

        <label>Harga Penggilingan (Rp):</label>
        <input type="number" name="harga_pg_gkp" />
        <small>(harga penggilingan ini harga jual penggilingan keluar)</small>
      </div>

      <!-- Gabah Kering Giling -->
      <div class="form-section">
        <h4>Gabah Kering Giling (GKG)</h4>
        <label>Stok Hari ini:</label>
        <input type="number" name="stok_gkg" />
        <small>(stok dalam satuan Kilogram)</small>

        <label>Kadar Air (%):</label>
        <input type="number" name="kadarair_gkg" />

        <label>Harga Petani (Rp):</label>
        <input type="number" name="harga_petani_gkg" />
        <small>(harga petani ini harga jual petani ke luar)</small>

        <label>Harga Penggilingan (Rp):</label>
        <input type="number" name="harga_pg_gkg" />
        <small>(harga penggilingan ini harga jual penggilingan keluar)</small>
      </div>

      <!-- Beras -->
      <div class="form-section">
        <h4>Beras</h4>
        <label>Stok Hari ini:</label>
        <input type="number" name="stok_beras" />
        <small>(stok dalam satuan Kilogram)</small>

        <label>Kadar Air (%):</label>
        <input type="number" name="kadarair_beras" />

        <label>Harga (Rp):</label>
        <input type="number" name="harga_beras" />
        <small>(harga beras jual keluar)</small>
      </div>

      <!-- Produksi Hari Ini -->
      <div class="form-section">
        <h4>Produksi Hari Ini</h4>
        <label>Jenis Gabah yang Digiling:</label>
        <select name="jenis_giling">
          <option value="">--Pilih--</option>
          <option value="GKP">GKP</option>
          <option value="GKG">GKG</option>
        </select>

        <label>Jumlah Gabah Digiling (Kg):</label>
        <input type="number" name="jml_giling" id="jml_giling" />

        <label>Hasil Beras (Kg):</label>
        <input type="number" name="hasil_beras" id="hasil_beras" />

        <label>Rendemen (%):</label>
        <input type="text" name="rendemen" id="rendemen" readonly />
        <small>Faktor Penurunan: jika ada penyusutan dari total gabah</small>

        <label>Varietas:</label>
        <input type="text" name="varietas" />

        <label>Asal Gabah:</label>
        <input type="text" name="asal_gabah" />

        <label>Lokasi:</label>
        <input type="text" name="lokasi" id="lokasi" readonly />
      </div>

      <button type="submit">Simpan Data</button>
    </form>
  </div>

  <script>
    // =======================
    //  AUTO HITUNG RENDEMEN
    // =======================
    const jmlGiling = document.getElementById("jml_giling");
    const hasilBeras = document.getElementById("hasil_beras");
    const rendemen = document.getElementById("rendemen");

    function hitungRendemen() {
      let giling = parseFloat(jmlGiling.value) || 0;
      let beras = parseFloat(hasilBeras.value) || 0;
      if (giling > 0) {
        rendemen.value = ((beras / giling) * 100).toFixed(2);
      } else {
        rendemen.value = "";
      }
    }
    jmlGiling.addEventListener("input", hitungRendemen);
    hasilBeras.addEventListener("input", hitungRendemen);

    // =============================
    //  DATA KECAMATAN & DESA/KELURAHAN
    // =============================
    const dataWilayah = {
      "Batang Tuaka": {
        kelurahan: ["Sungai Piring"],
        desa: [
          "Gemilang Jaya",
          "Kuala Sebatu",
          "Pasir Emas",
          "Sialang Jaya",
          "Simpang Jaya",
          "Sungai Dusun",
          "Sungai Junjangan",
          "Sungai Luar",
          "Sungai Rawa",
          "Sungai Raya",
          "Tanjung Siantar",
          "Tasik Raya"
        ]
      },
      "Concong": {
        kelurahan: ["Concong Luar"],
        desa: [
          "Concong Dalam",
          "Concong Tengah",
          "Kampung Baru",
          "Panglima Raja",
          "Sungai Berapit"
        ]
      },
      "Enok": {
        kelurahan: ["Enok", "Pusaran", "Pantai Seberang Makmur", "Simpang Tiga"],
        desa: [
          "Bagan Jaya",
          "Jaya Bhakti",
          "Pengalihan",
          "Rantau Panjang",
          "Simpang Tiga Daratan",
          "Suhada",
          "Sungai Ambat",
          "Sungai Lokan",
          "Sungai Rukam",
          "Teluk Medan"
        ]
      },
      "Gaung": {
        kelurahan: ["Kuala Lahang"],
        desa: [
          "Belantaraya",
          "Gembira",
          "Jerambang",
          "Lahang Baru",
          "Lahang Hulu",
          "Lahang Tengah",
          "Pintasan",
          "Pungkat",
          "Semambu Kuning",
          "Simpang Gaung",
          "Soren",
          "Sungai Baru",
          "Teluk Kabung",
          "Teluk Merbau",
          "Teluk Nibung",
          "Terusan Kempas"
        ]
      },
      "Gaung Anak Serka": {
        kelurahan: ["Teluk Pinang", "Tanjung Harapan", "Sungai Empat"],
        desa: [
          "Harapan Makmur",
          "Idaman",
          "Kelumpang",
          "Kuala Gaung",
          "Rambaian",
          "Sungai Iliran",
          "Teluk Pantaian",
          "Teluk Sungka",
          "Teluk Tuasan"
        ]
      },
      "Kateman": {
        kelurahan: ["Tagaraja", "Bandar Sri Gemilang", "Amal Bhakti"],
        desa: [
          "Air Tawar",
          "Kuala Selat",
          "Penjuru",
          "Sari Mulya",
          "Sungai Simbar",
          "Sungai Teritip",
          "Tanjung Raja",
          "Makmur Jaya"
        ]
      },
      "Kempas": {
        kelurahan: ["Kempas Jaya", "Harapan Tani"],
        desa: [
          "Bayas Jaya",
          "Danau Pulai Indah",
          "Karya Tani",
          "Kerta Jaya",
          "Kulim Jaya",
          "Pekan Tua",
          "Rumbai Jaya",
          "Sungai Ara",
          "Sungai Gantang",
          "Sungai Rabit"
        ]
      },
      "Kemuning": {
        kelurahan: ["Selensen"],
        desa: [
          "Air Balui",
          "Batu Ampar",
          "Tuk Jimun",
          "Kemuning Muda",
          "Kemuning Tua",
          "Keritang",
          "Limau Manis",
          "Lubuk Besar",
          "Sekara",
          "Sekayan",
          "Talang Jangkang"
        ]
      },
      "Keritang": {
        kelurahan: ["Kota Baru Reteh"],
        desa: [
          "Kayu Raja",
          "Kembang Mekar Sari",
          "Kota Baru Seberida",
          "Kuala Keritang",
          "Kuala Lemang",
          "Lintas Utara",
          "Nusantara Jaya",
          "Nyiur Permai",
          "Pancur",
          "Pasar Kembang",
          "Pebenaan",
          "Pengalihan",
          "Petalongan",
          "Seberang Pebenaan",
          "Sencalang",
          "Teluk Kelasa"
        ]
      },
      "Kuala Indragiri": {
        kelurahan: ["Sapat"],
        desa: [
          "Perigi Raja",
          "Sungai Bela",
          "Sungai Buluh",
          "Sungai Piyai",
          "Tanjung Lajau",
          "Tanjung Melayu",
          "Teluk Dalam"
        ]
      },
      "Mandah": {
        kelurahan: ["Khairiah Mandah"],
        desa: [
          "Bakau Aceh",
          "Bantaian",
          "Batang Sari",
          "Batang Tumu",
          "Bekawan",
          "Belaras",
          "Belaras Barat",
          "Bente",
          "Bidari Tanjung Datuk",
          "Bolak Raya",
          "Cahaya Baru",
          "Igal",
          "Pelanduk",
          "Pulau Cawan",
          "Sepakat Jaya",
          "Surayya Mandiri"
        ]
      },
      "Pelangiran": {
        kelurahan: ["Pelangiran"],
        desa: [
          "Bagan Jaya",
          "Baung Rejo Jaya",
          "Catur Karya",
          "Hidayah",
          "Intan Mulya Jaya",
          "Pinang Jaya",
          "Rotan Semelur",
          "Saka Palas Jaya",
          "Simpang Kateman",
          "Tagagiri Raja",
          "Tagagiri Tama Jaya",
          "Tanjung Simpang",
          "Tegal Rejo Jaya",
          "Teluk Bunian",
          "Terusan Beringin Jaya",
          "Wonosari"
        ]
      },
      "Pulau Burung": {
        kelurahan: [],
        desa: [
          "Bangun Harjo Jaya",
          "Beringin Jaya",
          "Binangun Jaya",
          "Bukit Sari Intan Jaya",
          "Keramat Jaya",
          "Manunggal Jaya",
          "Mayang Sari Jaya",
          "Pulau Burung",
          "Ringin Jaya",
          "Sapta Jaya",
          "Sempadan Jaya",
          "Sri Danai",
          "Suka Jaya",
          "Suko Harjo Jaya",
          "Sungai Danai",
          "Teluk Nibung"
        ]
      },
      "Reteh": {
        kelurahan: ["Pulau Kijang", "Madani", "Metro"],
        desa: [
          "Seberang Pulau Kijang",
          "Pulau Kecil",
          "Pulau Ruku",
          "Sanglar",
          "Seberang Sanglar",
          "Sungai Asam",
          "Sungai Mahang",
          "Sungai Terab",
          "Sungai Undan",
          "Tanjung Labuh"
        ]
      },
      "Sungai Batang": {
        kelurahan: ["Benteng"],
        desa: [
          "Benteng Barat",
          "Benteng Utara",
          "Kuala Patah Parang",
          "Kuala Sungai Batang",
          "Mugo Mulyo",
          "Pandan Sari",
          "Pasenggarahan"
        ]
      },
      "Tanah Merah": {
        kelurahan: ["Kuala Enok"],
        desa: [
          "Selat Nama",
          "Sungai Laut",
          "Sungai Nyiur",
          "Tanah Merah",
          "Tanjung Baru",
          "Tanjung Pasir",
          "Tekulai Bugis",
          "Tekulai Hilir",
          "Tekulai Hulu"
        ]
      },
      "Teluk Belengkong": {
        kelurahan: [],
        desa: [
          "Beringin Mulya",
          "Gembaran",
          "Griya Mukti Jaya",
          "Hibrida Jaya",
          "Hibrida Mulya",
          "Indra Sari Jaya",
          "Kelapa Patih Jaya",
          "Saka Rotan",
          "Sapta Mulya Jaya",
          "Sumber Jaya",
          "Sumber Makmur Jaya",
          "Sumber Sari Jaya",
          "Tunggal Rahayu Jaya"
        ]
      },
      "Tembilahan": {
        kelurahan: ["Tembilahan Hilir", "Pekan Arba", "Seberang Tembilahan", "Seberang Tembilahan Barat", "Seberang Tembilahan Selatan"],
        desa: [
          "Sungai Beringin",
          "Sungai Perak",
          "Tembilahan Kota"
        ]
      },
      "Tembilahan Hulu": {
        kelurahan: ["Pekan Kamis", "Pulau Palas", "Sialang Panjang", "Tembilahan Hulu"],
        desa: [
          "Sungai Intan",
          "Tembilahan Barāt"
        ]
      },
      "Tempuling": {
        kelurahan: ["Harapan Jaya", "Karya Tunas Jaya", "Mumpa"],
        desa: [
          "Pangkalan Tujuh",
          "Sungai Salak",
          "Teluk Jira",
          "Tempuling Jaya"
        ]
      }
    };

    // fungsi isi dropdown berdasarkan pilihan kecamatan
    const kecamatanSelect = document.getElementById("kecamatan");
    const desaSelect = document.getElementById("desa");

    kecamatanSelect.addEventListener("change", function () {
      const selected = this.value;
      desaSelect.innerHTML = '<option value="">-- Pilih Desa/Kelurahan --</option>';
      if (dataWilayah[selected]) {
        // isi kelurahan dulu
        dataWilayah[selected].kelurahan.forEach(kel => {
          const opt = document.createElement("option");
          opt.value = kel;
          opt.textContent = kel + " (Kelurahan)";
          desaSelect.appendChild(opt);
        });
        // isi desa
        dataWilayah[selected].desa.forEach(desa => {
          const opt = document.createElement("option");
          opt.value = desa;
          opt.textContent = desa + " (Desa)";
          desaSelect.appendChild(opt);
        });
      }
    });

    // =======================
    //  AMBIL LOKASI OTOMATIS
    // =======================
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async pos => {
        let lat = pos.coords.latitude;
        let lon = pos.coords.longitude;
        try {
          let res = await fetch(
            `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`
          );
          let data = await res.json();
          let alamat = data.display_name || "Tidak diketahui";
          document.getElementById("lokasi").value =
            `${lat}, ${lon} - ${alamat}`;
        } catch (e) {
          document.getElementById("lokasi").value = `${lat}, ${lon}`;
        }
      });
    }

// Kirim ke Google Apps Script
  const form = document.getElementById("dataForm");

form.addEventListener("submit", async function(e) {
  e.preventDefault();

  const formData = new FormData(form);

  try {
    let res = await fetch("https://script.google.com/macros/s/AKfycbwRucDgSwLenBAfNycremHBCF_INCzbmhfiimAeo3_K7G_8wFriImj0fWHzB_0n_pbODw/exec", {
      method: "POST",
      body: formData
    });

    let result = await res.json();
    alert(result.message || "✅ Data berhasil dikirim ke Spreadsheet!");
    form.reset();
  } catch (err) {
    alert("❌ Gagal menyimpan data: " + err);
  }
});
</script>
</body>
</html>
