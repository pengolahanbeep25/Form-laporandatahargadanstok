<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Stok Gabah & Beras</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    margin: 20px;
    background: #f5f5f5;
  }
  h2 {
    text-align: center;
    margin-bottom: 10px;
  }
  .filter-container {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    flex-wrap: wrap;
    gap: 5px;
  }
  select, button {
    padding: 5px 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    background-color: white;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 6px;
    text-align: center;
    vertical-align: middle;
    word-wrap: break-word;
  }
  th {
    background: #007bff;
    color: white;
    font-size: 13px;
  }
  td {
    font-size: 13px;
  }
  td.lokasi {
    white-space: normal;
    max-width: 150px;
  }
  .total-row {
    font-weight: bold;
    background: #f0f8ff;
  }
  .btn-container {
    margin-top: 10px;
    text-align: right;
  }
  .btn-container button {
    margin-left: 5px;
  }

  /* Print-friendly */
  @media print {
    body { background: white; }
    button, select { display: none; }
    table { page-break-inside: auto; width: 100%; }
    tr { page-break-inside: avoid; page-break-after: auto; }
    th, td { font-size: 11px; word-wrap: break-word; }
  }
</style>
</head>
<body>

<h2>Laporan Stok Gabah & Beras</h2>

<div class="filter-container">
  <select id="filterNama">
    <option value="">-- Pilih Nama Penggilingan --</option>
    <option>Aswad</option>
    <option>Abdul Wahab</option>
    <option>Misbar</option>
    <option>Legi Royani</option>
  </select>
  <button onclick="tampilkanSemua()">Tampilkan Semua</button>
</div>

<table id="dataTable">
  <thead>
    <tr>
      <th>Timestamp</th>
      <th>Nama</th>
      <th>Kecamatan</th>
      <th>Desa/Kelurahan</th>
      <th>Stok GKP</th>
      <th>Stok GKG</th>
      <th>Stok Beras</th>
      <th>Hasil Beras (Ton)</th>
      <th>Lokasi</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody id="dataBody">
    <!-- contoh data -->
    <tr>
      <td>2025-04-12</td><td>Aswad</td><td>Tempuling</td><td>Teluk Jira</td>
      <td>1.200</td><td>900</td><td>800</td><td>0.8</td><td class="lokasi">Jl. Lintas Timur, RT 03 RW 01, Kelurahan Teluk Jira</td>
      <td><button onclick="hapusData(this)">Hapus</button></td>
    </tr>
    <tr>
      <td>2025-04-14</td><td>Legi Royani</td><td>Gaung</td><td>Teluk Kabung</td>
      <td>2.000</td><td>1.000</td><td>1.100</td><td>1.1</td><td class="lokasi">Desa Teluk Kabung, Gaung</td>
      <td><button onclick="hapusData(this)">Hapus</button></td>
    </tr>
  </tbody>
  <tfoot>
    <tr class="total-row" id="totalRow">
      <td colspan="4">Total</td>
      <td id="totalGKP">0</td>
      <td id="totalGKG">0</td>
      <td id="totalBeras">0</td>
      <td id="totalHasil">0</td>
      <td colspan="2"></td>
    </tr>
  </tfoot>
</table>

<div class="btn-container">
  <button onclick="downloadExcel()">Download Excel</button>
  <button onclick="window.print()">Print</button>
</div>

<script>
function hitungTotal() {
  let totalGKP = 0, totalGKG = 0, totalBeras = 0, totalHasil = 0;
  const rows = document.querySelectorAll("#dataBody tr");
  rows.forEach(r => {
    totalGKP += parseFloat(r.cells[4].innerText.replace(/[.,]/g, '')) || 0;
    totalGKG += parseFloat(r.cells[5].innerText.replace(/[.,]/g, '')) || 0;
    totalBeras += parseFloat(r.cells[6].innerText.replace(/[.,]/g, '')) || 0;
    totalHasil += parseFloat(r.cells[7].innerText.replace(/[.,]/g, '')) || 0;
  });
  document.getElementById("totalGKP").innerText = totalGKP.toLocaleString();
  document.getElementById("totalGKG").innerText = totalGKG.toLocaleString();
  document.getElementById("totalBeras").innerText = totalBeras.toLocaleString();
  document.getElementById("totalHasil").innerText = totalHasil.toLocaleString();
}

function tampilkanSemua() {
  document.querySelectorAll("#dataBody tr").forEach(tr => tr.style.display = "");
  hitungTotal();
}

function hapusData(btn) {
  btn.parentElement.parentElement.remove();
  hitungTotal();
}

document.getElementById("filterNama").addEventListener("change", function() {
  const val = this.value.toLowerCase();
  document.querySelectorAll("#dataBody tr").forEach(tr => {
    const nama = tr.cells[1].innerText.toLowerCase();
    tr.style.display = (val === "" || nama.includes(val)) ? "" : "none";
  });
  hitungTotal();
});

function downloadExcel() {
  const table = document.getElementById("dataTable").outerHTML;
  const blob = new Blob(["\ufeff" + table], { type: "application/vnd.ms-excel" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "Laporan_Stok_Gabah_Beras.xls";
  a.click();
  URL.revokeObjectURL(url);
}

window.onload = hitungTotal;
</script>
</body>
</html>
